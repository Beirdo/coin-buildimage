# /bin/bash

%=- POOLNODE 1
# Download the pool wallet
mkdir -p /home/coinnode/.@COINNAME@
aws s3 cp @WALLETBUCKET@/@COINNAME@/pool-wallet.dat \
	/home/coinnode/.@COINNAME@/wallet.dat
=%
%=- GRABWALLET 1
# Download the wallet
mkdir -p /home/coinnode/.@COINNAME@
aws s3 cp @WALLETBUCKET@/@COINNAME@/wallet.dat \
	/home/coinnode/.@COINNAME@/wallet.dat
=%
%=- GRABSNAPSHOT 1
# Download the wallet
mkdir -p /home/coinnode/.@COINNAME@
aws s3 cp @WALLETBUCKET@/@COINNAME@/snapshot.zip /tmp/snapshot-@COINNAME@.zip
cd /home/coinnode/.@COINNAME@
unzip -ao /tmp/snapshot-@COINNAME@.zip
cd /home/coinnode
rm /tmp/snapshot-@COINNAME@.zip

=%
# Start the coin daemon
/usr/local/bin/@COINNAME@d --daemon

%=- USEEXPLORER 1
# Start mongodb and the explorer (if using the explorer)
cd /home/coinnode/src/explorer
sudo /etc/init.d/mongodb start
mongo < /tmp/explorer.mongo
sudo /etc/init.d/cron start
screen npm start
crontab -u coinnode crontab
rm /tmp/explorer.mongo
=%
%=- USEP2POOL 1
# Startup p2pool
cd /home/coinnode/src/p2pool
screen ./run_p2pool.py --net @COINNAME@ --disable-upnp --address @P2PADDRESS@

=%
cd /home/coinnode
/bin/bash
