# /bin/bash

# Download the wallet
mkdir -p /home/coinnode/.@COINNAME@
aws s3 cp @WALLETBUCKET@/@COINNAME@/wallet.dat \
	/home/coinnode/.@COINNAME@/wallet.dat

# Start the coin daemon
/usr/local/bin/@COINNAME@d --daemon

# Start mongodb and the explorer (if using the explorer)
if [ "@USEEXPLORER@" = "1" ] ; then
    cd /home/coinnode/src/explorer
    sudo /etc/init.d/mongodb start
    mongo < explorer.mongo
    sudo /etc/init.d/cron start
    screen npm start
    crontab -u coinnode explorer.crontab
fi

# Startup p2pool
if [ "@USEP2POOL@" = "1" ] ; then
    cd /home/coinnode/src/p2pool
    screen ./run_p2pool.py --net @COINNAME@ --disable-upnp --address @P2PADDRESS@
fi

cd /home/coinnode
/bin/bash
